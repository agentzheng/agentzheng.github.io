<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<style type="text/css">
		body, html,#allmap {width: 100%;height: 100%;overflow: hidden;margin:0;font-family:"微软雅黑";}
	</style>
	<script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=ebiqfAg22fsd4stMeVNnYpPxZAL1wTNg"></script>
	<script type="text/javascript" src="data.js"></script>
	<script type="text/javascript" src="predefine.js"></script>
	<title>Elliott's Data Structure Homework</title>
</head>
<body>
	<div id="allmap"></div>
	<div id="r-result"></div>
</body>
</html>
<script type="text/javascript">
	

	// 百度地图API功能
	var map = new BMap.Map("allmap");  // 创建Map实例
	var walking = new BMap.WalkingRoute(map, {renderOptions: {map: map, panel: "r-result", autoViewport: true}});
	map.enableScrollWheelZoom(true);
	walking.setSearchCompleteCallback(function(){
					var distance=walking.getResults().getPlan(0).getRoute(0).getDistance(false);
					var start_point=walking.getResults().getStart().point;
					var start=-1;
					var end=-1;
					var end_point=walking.getResults().getEnd().point;
					for(var i=0;i<Point_Set.length;i++)
					{
						if(map.getDistance(Point_Set[i],start_point)<10)
							start=i;
						if(map.getDistance(Point_Set[i],end_point)<10)
							end=i;
					}
					if(start==end)
					{
						alert("error");
					}
					//alert(""+start+"to"+end);
					
					if(start<N&&end<N&&(!Edge_Weight[start][end])){
						Edge_Weight[start][end]=distance*(parseInt(Point_info[start][3]));
						Edge_Weight[end][start]=distance*(parseInt(Point_info[end][3]));
					}
					walking.clearResults();
				});
	
	map.centerAndZoom(new BMap.Point(118.105444,24.443135), 18);

	for(var i=0;i<Point_info.length;i++)
	{
		Point_Set[i]=new BMap.Point(Point_info[i][0],Point_info[i][1]);
		var marker = new BMap.Marker(Point_Set[i]);  // 创建标注
		var content = "名称:"+Point_info[i][2]+"\n代号:"+(i+1)+"\n搜索权重:"+Point_info[i][3];
		var markerMenu=new BMap.ContextMenu();
		map.addOverlay(marker);               // 将标注添加到地图中
		markerMenu.addItem(new BMap.MenuItem('从这里出发',From.bind(marker)));
		markerMenu.addItem(new BMap.MenuItem('到这里',To.bind(marker)));
		markerMenu.addItem(new BMap.MenuItem('最优路径权值加和',Floyd.bind(marker)));
		marker.addContextMenu(markerMenu);
		addClickHandler(content,marker);
	}


	var cr = new BMap.CopyrightControl({anchor: BMAP_ANCHOR_TOP_RIGHT});   //设置版权控件位置
	map.addControl(cr); //添加版权控件
	var bs = map.getBounds();   //返回地图可视区域
	cr.addCopyright({id: 1, content: "<a href='https://www.cnblogs.com/elliottzheng/' style='font-size:20px;'>Xiamen University Software School Elliott Zheng</a>", bounds: bs});   
	//Copyright(id,content,bounds)类作为CopyrightControl.addCopyright()方法的参数
	
	var market = new Market();
	map.addControl(market);

	//构建邻接距离矩阵Edge-distance
	for(var i=0;i<Point_info.length;i++)
	{
		for(var j=0;j<Point_info.length;j++)
		{
			if(i==j)
			{
				Edge_Weight[i][j]=0;
			}
			else
				walking.search(new BMap.Point(Point_info[i][0],Point_info[i][1]),new BMap.Point(Point_info[j][0],Point_info[j][1]));
		}
	}




	         
</script>